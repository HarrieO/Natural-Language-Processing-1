import csv
import sys
import numpy as np
import random

random.seed(0)
maxInt = int(sys.maxsize/(10**10))
csv.field_size_limit(maxInt)

def read_column(colNr, fileName):
	with open(fileName) as csvfile:
		readerObject = csv.reader(csvfile, delimiter=',')
		row = next(readerObject)
		column = []
		for row in readerObject:
			counter = 0
			for col in row:
				if counter == colNr:
					column.append(col)
					break
				counter = counter+1
		return column

def write_csv(data,fileName):
	with open(fileName, 'wb') as csvfile:
	    writerObject = csv.writer(csvfile, delimiter=',')
	    for row in data:
	    	writerObject.writerow(row)

def make_list(col1,col2,col3, indices):
	combinedList = []
	for index in indices:
		combinedList.append([col1[index], col2[index], col3[index]])
	return combinedList

# Read all data
#sentencesSE  = np.array(read_column(2,'stack-exchange.annotated.csv')) # sentences
scoresSElist = read_column(13,'stack-exchange.annotated.csv') # mean score
scoresSE     = np.zeros(len(scoresSElist))
for i in range(len(scoresSElist)):
	scoresSE[i] = scoresSElist[i]
turkScoresSE = np.zeros([5,len(scoresSElist)])
for i in [3,4,5,6,7]:
	turkListSE = read_column(i,'stack-exchange.annotated.csv') # mean score
	for k in range(len(turkListSE)):
		turkScoresSE[i-3,k]= turkListSE[k]
#sentencesWIK  = np.array(read_column(2,'wikipedia.annotated.csv')) # sentences
scoresWIKlist = read_column(13,'wikipedia.annotated.csv') # mean score
scoresWIK     = np.zeros(len(scoresWIKlist))
for i in range(len(scoresWIKlist)):
	scoresWIK[i] = scoresWIKlist[i]
turkScoresWIK = np.zeros([5,len(scoresWIKlist)])
for i in [3,4,5,6,7]:
	turkListWIK = read_column(i,'wikipedia.annotated.csv') # mean score
	for k in range(len(turkListWIK)):
		turkScoresWIK[i-3,k]= turkListWIK[k]

def classFromScore(score):
	if score>0.5:
		return 1
	elif score <-0.5:
		return -1
	else:
		return 0
def classFromTurkScore(score, left = 8, right =17):
	if score < left:
		return -1
	elif score > right:
		return 1
	else:
		return 0 
def testTurksRandom(left=8, right =17):
	mistakes = 0
	for i in range(len(scoresSElist)):
		turkIndex = random.randint(0,4)
		if( classFromTurkScore(turkScoresSE[turkIndex, i], left, right)!= classFromScore(scoresSE[i])):
			mistakes +=1


	mistakes = 0
	for i in range(len(scoresWIKlist)):
		turkIndex = random.randint(0,4)
		if( classFromTurkScore(turkScoresWIK[turkIndex, i], left, right)!= classFromScore(scoresWIK[i])):
			mistakes +=1
	percentage = (1.0-mistakes / float(len(scoresSElist)+len(scoresWIKlist))) * 100.0
	print "For split (",left, ",", right, "), ", percentage, "% was classified correctly"
	return percentage

bestI = 2
bestJ = 13
bestPercentage = 0
for i in [6,7,8,9,10,11,12]:
	for j in [13,14,15,16,17,18,19,20,22]:
		percentage = testTurksRandom(i,j)
		if percentage > bestPercentage:
			bestPercentage = percentage
			bestI = i
			bestJ = j

print "Best (i,j) is ", (bestI,bestJ), ", best percentage is ", bestPercentage

